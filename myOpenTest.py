#!/usr/bin/python2.7 -3
#-*- coding: utf-8 -*-

#
# (c) Raphael Jacquot 2014
# Licenced under the terms of the GNU GPL v3.0 or later
#

import config
import myOpenLayer1
import myOpenTempControl

class MyOpenApplication (object) :
    def __init__ (self) :
        # prepare the app startup
        # create the system loop
        self.system_loop = myOpenLayer1.MainLoop(myOpenLayer1.system_logger)
        # open the monitor socket to the gateway
        self.monitor_socket = myOpenLayer1.OwnSocket(
                config.host,
                config.port,
                config.password,
                myOpenLayer1.OwnSocket.MONITOR)
        # set the callback to get messages from the layer 1
        self.monitor_socket.set_data_callback(self.data_callback)
        # add the monitor socket to the system loop
        self.system_loop.add_socket(self.monitor_socket)
        # run the system loop.
        self.system_loop.run()

    def data_callback (self, msg) :
        # analyze the content of messages passed from the layer 1
        self.monitor_socket.log (msg)

# main program
if __name__ == '__main__' :
    # create the application object, run the main loop
    MyOpenApplication ()
